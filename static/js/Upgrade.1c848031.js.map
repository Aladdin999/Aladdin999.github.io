{"version":3,"sources":["webpack:///./src/assets/images/yes.png","webpack:///./src/views/Upgrade/index.vue?130e","webpack:///src/views/Upgrade/index.vue","webpack:///./src/views/Upgrade/index.vue?be7e","webpack:///./src/views/Upgrade/index.vue","webpack:///./src/views/Upgrade/index.vue?9e21"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","$t","_l","i","key","attrs","domProps","toLevel","on","$event","changeLevel","Number","allow","upgradeLevel","approve","needAmount","staticRenderFns","mixins","data","showStatusTip","userLevel","aldToken","btnStatus","created","address","initData","methods","getUserLevel","getAllow","$ald","then","allowance","level","getUpgradeLevelAmount","getLevelAmount","watch","val","component"],"mappings":"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","file":"static/js/Upgrade.1c848031.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAr0lEQVQ4T+XU0Q2CMBDG8f/JDi6hO4jGGdhRN/AFYQcZwxH0rCSSVkoLlAcT+9rk1+vd1woLL1nY409ALdnJgfrdvuQra80JZSs5m2Twg/GkMBU2SaAPmw0OYbPAEOaAeiWXPVUo6DHMBau2qY2ZVuFDx2AuWJqxrzj70LFYr4cmoD10CuYdSocKt/bqJrR2zmKfifelWJUyBQvGRi+syXjIkXusKns/+S1/H/b74At6MVYVmeOyWQAAAABJRU5ErkJggg==\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\"},[_c('div',{staticClass:\"card-box\"},[_c('div',{staticClass:\"card-title\"},[_c('span',{staticClass:\"gradient-title\"},[_vm._v(_vm._s(_vm.$t('upgrade.t')))])]),_c('div',{staticClass:\"card-content\"},[_vm._l((7),function(i){return [_c('input',{key:(\"r\" + i),attrs:{\"type\":\"radio\",\"id\":(\"lv\" + i),\"name\":\"level\"},domProps:{\"checked\":i == _vm.toLevel},on:{\"click\":function($event){return _vm.changeLevel(i)}}}),_c('label',{key:(\"l\" + i),attrs:{\"for\":(\"lv\" + i)}},[_c('span',[_vm._v(\"LV.\"+_vm._s(i))]),_c('img',{attrs:{\"src\":require(\"images/yes.png\"),\"alt\":\"\"}})])]}),(!Number(_vm.allow))?_c('div',{staticClass:\"up-btn theme-btn\",on:{\"click\":_vm.approve}},[_c('span',[_vm._v(_vm._s(_vm.$t('upgrade.approve'))+\"ALD\")])]):_c('div',{staticClass:\"up-btn theme-btn\",on:{\"click\":_vm.upgradeLevel}},[_c('span',[_vm._v(_vm._s(_vm.$t('upgrade.t')))])])],2)]),_c('div',{staticClass:\"tip-box\"},[_c('div',{staticClass:\"tip-title\"},[_vm._v(_vm._s(_vm.$t('upgrade.tt'))+\":\")]),_c('div',{staticClass:\"tip\"},[_c('span',{staticClass:\"label\"},[_vm._v(\"Lv.\"+_vm._s(_vm.toLevel))]),_c('span',{staticClass:\"content\"},[_vm._v(\" \"+_vm._s(_vm.$t('upgrade.tip'))+\" \"),_c('span',[_vm._v(_vm._s(_vm.needAmount))]),_vm._v(\" ALD \")])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"wrapper\">\r\n    <div class=\"card-box\">\r\n      <div class=\"card-title\">\r\n        <span class=\"gradient-title\">{{$t('upgrade.t')}}</span>\r\n      </div>\r\n      <div class=\"card-content\">\r\n        <template v-for=\"i in 7\">\r\n          <input :checked=\"i == toLevel\" type=\"radio\" :id=\"`lv${i}`\" name=\"level\" :key=\"`r${i}`\" @click=\"changeLevel(i)\">\r\n          <label :for=\"`lv${i}`\" :key=\"`l${i}`\">\r\n            <span>LV.{{i}}</span>\r\n            <img src=\"~images/yes.png\" alt=\"\">\r\n          </label>\r\n        </template>\r\n        <div class=\"up-btn theme-btn\" @click=\"approve\" v-if=\"!Number(allow)\">\r\n          <span>{{$t('upgrade.approve')}}ALD</span>\r\n        </div>\r\n        <div class=\"up-btn theme-btn\" @click=\"upgradeLevel\" v-else>\r\n          <span>{{$t('upgrade.t')}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"tip-box\">\r\n      <div class=\"tip-title\">{{$t('upgrade.tt')}}:</div>\r\n      <div class=\"tip\">\r\n        <span class=\"label\">Lv.{{toLevel}}</span>\r\n        <span class=\"content\">\r\n          {{$t('upgrade.tip')}} <span>{{needAmount}}</span> ALD\r\n        </span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { commonMixin } from '@/utils/mixins'\r\nimport { Ald, aldAddr } from '@/utils/addr'\r\nimport { ethers } from 'ethers'\r\nimport { MaxUint256 } from '@ethersproject/constants'\r\nimport tokenAbi from '@/abi/erc20.json'\r\n\r\nexport default {\r\n  mixins: [ commonMixin ],\r\n  data () {\r\n    return {\r\n      showStatusTip: false,\r\n      userLevel: '0',\r\n      toLevel: '',\r\n      needAmount: '0.0000',\r\n      aldToken: null,\r\n      allow: 0,\r\n      btnStatus: 0 // 0 提升 1 授权\r\n    }\r\n  },\r\n  created() {\r\n    if (this.address) {\r\n      this.initData()\r\n    }\r\n  },\r\n  methods: {\r\n    initData () {\r\n      this.aldToken = (new ethers.Contract(Ald, tokenAbi, this.$provider))\r\n          .connect(this.$store.state.signer)\r\n      this.getUserLevel()\r\n      this.getAllow()\r\n    },\r\n    getUserLevel () {\r\n      this.$ald.userLevel(this.address).then(res => {\r\n        this.userLevel = res.toString()\r\n        this.toLevel = res.toString()\r\n      })\r\n    },\r\n    getAllow () {\r\n      this.aldToken.allowance(this.address, aldAddr).then(res => {\r\n        this.allow = res.toString()\r\n      })\r\n    },\r\n    approve () {\r\n      this.aldToken.approve(aldAddr, MaxUint256).then(() => {\r\n        this.getAllow()\r\n      })\r\n    },\r\n    changeLevel (level) {\r\n      if(Number(level) <= Number(this.userLevel)) {\r\n        this.toLevel = this.userLevel\r\n        return\r\n      }\r\n      this.toLevel = level\r\n      this.getUpgradeLevelAmount(level)\r\n    },\r\n    async upgradeLevel () {\r\n       let balance = await this.aldToken.balanceOf(this.address)\r\n       if(Number(balance.toString()/Math.pow(10, 18)) < this.needAmount) {\r\n         this.$toast('余额不足')\r\n         return\r\n       }\r\n       this.$ald.upgradeLevel(this.toLevel, {from: this.address}).then(() => {\r\n        })\r\n    },\r\n    getUpgradeLevelAmount (level) {\r\n      this.$ald.getLevelAmount(level, this.address).then(res => {\r\n        this.needAmount = Number(res.toString()/Math.pow(10, 18)).toFixed(4)\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    address (val) {\r\n      if (val) {\r\n        this.initData()\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.wrapper {\r\n  padding: 12px;\r\n}\r\n.card-box {\r\n  background: #fff;\r\n  border-radius: 5px;\r\n  .card-title {\r\n    line-height: 46px;\r\n    padding: 0 12px;\r\n    border-bottom: 1px solid #DEDEDE;\r\n  }\r\n  .card-content {\r\n    padding: 0 12px 20px;\r\n    input {\r\n      display: none;\r\n      &:checked + label {\r\n        color: @theme-color;\r\n        img {\r\n          display: block;\r\n        }\r\n      }\r\n    }\r\n    label {\r\n      height: 40px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      border-bottom: 1px solid #DEDEDE;\r\n      img {\r\n        display: none;\r\n      }\r\n    }\r\n    .up-btn {\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n}\r\n.tip-box {\r\n  margin-top: 20px;\r\n  .tip-title {\r\n\r\n  }\r\n  .tip {\r\n    margin-top: 16px;\r\n    padding-left: 12px;\r\n    .label {\r\n      margin-right: 40px;\r\n    }\r\n    .content {\r\n      span {\r\n        color: @theme-color;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=bdac9c4a&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=bdac9c4a&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bdac9c4a\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=bdac9c4a&lang=less&scoped=true&\""],"sourceRoot":""}